<title>Wordie v0.51</title>
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta charset="utf-8">
<style>
  body {
    margin: 0;
    overscroll-behavior: none; /* Disable Chrome two fingers back/forward swipe */
    user-select: none;  /* Prevent accidental selection while dragging mouse */

    font-family: sans-serif;
  }

  h1 {
    text-align: center;
    vertical-align: middle;
    margin: 4px;
  }

  .board {
    display: table;
    border-spacing: 4px;
    font-size: 32px;
    margin: auto;
  }

  .guess {
    display: table-row;
  }

  .message {
    display: table-cell;
    text-align: center;
    vertical-align: middle;
  }

  .letter {
    display: table-cell;
    border: 2px solid black;
    width: 48px;
    height: 48px;
    font-family: sans-serif;
    font-weight: bold;
    
    text-align: center;
    vertical-align: middle;
    text-transform: uppercase;
  }

  .alphabet {
    display: table;
    border-spacing: 2px;
    margin: auto;
  }

  .alpha-row {
    display: table-row;
  }
  
  .wrong {
    background-color: dimgray;
    color: white;
  }
  .partial {
    background-color: goldenrod;
    color: white;
  }
  .correct {
    background-color: green;
    color: white;
  }

</style>

<body>
  <h1>Wordie</h1>
</body>

<script type="module">

  const MAX_GUESSES = 6;
  const NUM_LETTERS = 5;

  const DEFAULT_MESSAGE = 'Choose your letters then click Guess.';

  const Guess = { Wrong: 'wrong', Partial: 'partial', Correct: 'correct' };

  class Board {
    answer;
    div;

    #guessIndex = 0;
    #letterIndex = 0;

    constructor( answer ) {
      this.answer = answer;

      this.div = document.createElement( 'div' );
      this.div.className = 'board';

      for ( let g = 0; g < MAX_GUESSES; g ++ ) {
        const guess = document.createElement( 'div' );
        guess.className = 'guess';

        for ( let l = 0; l < NUM_LETTERS; l ++ ) {
          const letter = document.createElement( 'div' );
          letter.className = 'letter';
          guess.appendChild( letter );
        }

        this.div.appendChild( guess );
      }
    }

    addLetter( letter ) {
      if ( this.#letterIndex < NUM_LETTERS ) {
        const letterDiv = this.div.children[ this.#guessIndex ].children[ this.#letterIndex ];
        letterDiv.textContent = letter;
        this.#letterIndex ++;

        messageDiv.textContent = DEFAULT_MESSAGE;
      }
      else {
        messageDiv.textContent = 'Too many letters!';
      }
    }

    clearLetter() {
      if ( 0 < this.#letterIndex ) {
        this.#letterIndex --;
        const letterDiv = this.div.children[ this.#guessIndex ].children[ this.#letterIndex ];
        letterDiv.textContent = '';

        messageDiv.textContent = DEFAULT_MESSAGE;
      }
      else {
        messageDiv.textContent = 'Already empty!';
      }
    }

    applyGuess() {
      if ( this.#letterIndex != NUM_LETTERS ) {
        messageDiv.textContent = `Not enough letters!`;
        return;
      }

      const guess = this.div.children[ this.#guessIndex ];
      const word = [ ...guess?.children ].map( child => child.textContent ).join('');

      if ( !words.includes( word ) ) {
        messageDiv.textContent = `'${ word.toUpperCase() }' is not an allowed word.`;
        return;
      }

      let numTotal = 0, numCorrect = 0;

      for ( let i = 0; i < NUM_LETTERS; i ++ ) {
        const letterDiv = guess.children[ i ];
        const letter = letterDiv.textContent;

        if ( letter == this.answer[ i ] ) {
          letterDiv.classList.add( Guess.Correct );

          alphabet[ letter ].classList.remove( Guess.Partial );
          alphabet[ letter ].classList.add( Guess.Correct );

          numCorrect ++;
          numTotal ++;
        }
        else if ( this.answer.includes( letter ) ) {
          letterDiv.classList.add( Guess.Partial );

          alphabet[ letter ].classList.remove( Guess.Correct );
          alphabet[ letter ].classList.add( Guess.Partial );

          numTotal ++;
        }
        else {
          letterDiv.classList.add( Guess.Wrong );
          alphabet[ letter ].classList.add( Guess.Wrong );
        }
      }

      messageDiv.textContent = `Found ${ numTotal } letters, ${ numCorrect } in correct spot.`;

      this.#guessIndex ++;
      this.#letterIndex = 0;
      
      if ( word == this.answer ) {
        messageDiv.textContent = `Correctly guessed with ${ this.#guessIndex } tries!`;
      }
      else if ( this.#guessIndex == MAX_GUESSES ) {
        messageDiv.textContent = `Out of tries! Answer was: '${ this.answer.toUpperCase() }'.`;
      }
    }
  }

  const words = ( await ( await fetch( 'sgb-words.txt' ) ).text() ).split( '\n' );
  const board = new Board( words[ Math.floor( Math.random() * 1000 ) ] );

  document.body.appendChild( board.div );

  const alphabet = {};
  const alphabetDiv = document.createElement( 'div' );
  alphabetDiv.className = 'alphabet';

  let index = 0;
  for ( let row = 0; row < 3; row ++ ) {
    const alphaRowDiv = document.createElement( 'div' );
    alphaRowDiv.className = 'alpha-row';

    for ( let col = 0; col < 9 && index < 26; col ++, index ++ ) {
      const letter = String.fromCharCode( 'a'.charCodeAt( 0 ) + index );

      const letterDiv = document.createElement( 'div' );
      letterDiv.className = 'letter';
      letterDiv.textContent = letter;
      letterDiv.onclick = () => board.addLetter( letter );

      alphabet[ letter ] = letterDiv;

      alphaRowDiv.appendChild( letterDiv );
    }
    
    alphabetDiv.appendChild( alphaRowDiv );
  }

  document.body.appendChild( alphabetDiv );

  const clearButton = document.createElement( 'div' );
  clearButton.className = 'letter';
  clearButton.style = 'font-size: 20px; height: 20px';
  clearButton.innerHTML = '&nbsp;Clear&nbsp;';
  clearButton.onclick = () => board.clearLetter();
  document.body.appendChild( clearButton );

  const messageDiv = document.createElement( 'div' );
  messageDiv.className = 'message';
  messageDiv.textContent = DEFAULT_MESSAGE;
  document.body.appendChild( messageDiv );

  const applyButton = document.createElement( 'div' );
  applyButton.className = 'letter';
  applyButton.style = 'font-size: 20px; height: 20px';
  applyButton.innerHTML = '&nbsp;Guess&nbsp;';
  applyButton.onclick = () => board.applyGuess();
  document.body.appendChild( applyButton );

  document.onkeydown = ( e ) => {
    if ( e.key.length == 1 && /[a-z]/i.test( e.key ) ) {
      board.addLetter( e.key );
    }
    else if ( e.key == 'Backspace' ) {
      board.clearLetter();
    }
    else if ( e.key == 'Enter' ) {
      board.applyGuess();
    }
  }

</script>